# 🧪 식단 플래너 API 테스트 결과 보고서

**테스트일시:** 2026-02-10
**환경:** Python 3.12 + FastAPI + SQLite (테스트용)

---

## ✅ API 엔드포인트 테스트 결과 (13/13 통과)

| # | Method | Endpoint | 결과 | 비고 |
|---|--------|----------|------|------|
| 1 | POST | `/api/users/` | ✅ 200 | 사용자 등록 + TDEE 자동 계산 |
| 2 | GET | `/api/users/{id}` | ✅ 200 | 사용자 조회 |
| 3 | POST | `/api/users/tdee` | ✅ 200 | BMR/TDEE/끼니별 배분 계산 |
| 4 | GET | `/api/recipes/` | ✅ 200 | 27개 레시피 목록 |
| 5 | GET | `/api/recipes/{id}` | ✅ 200 | 레시피 상세 (조리순서 포함) |
| 6 | GET | `/api/recipes/{id}/ingredients` | ✅ 200 | 재료 + 정량(g) |
| 7 | GET | `/api/recipes/{id}/nutrition` | ✅ 200 | 칼로리/탄단지/나트륨 |
| 8 | POST | `/api/menu/generate` | ✅ 200 | 21개 메뉴 자동 생성 |
| 9 | GET | `/api/menu/{user_id}/today` | ✅ 200 | 오늘 3끼 조회 |
| 10 | GET | `/api/menu/{user_id}/current` | ✅ 200 | 주간 메뉴 전체 |
| 11 | POST | `/api/menu/item/{id}/replace` | ✅ 200 | 한 끼 교체 (제육볶음→된장찌개) |
| 12 | GET | `/api/shopping/{user_id}/current` | ✅ 200 | 장보기 리스트 26개 재료 |
| 13 | PATCH | `/api/shopping/item/check` | ✅ 200 | 장보기 체크/해제 |

---

## 📋 주간 메뉴 자동 생성 결과 (2026-02-09 ~ 2026-02-15)

```
📅 월 (2026-02-09)
  아침: 토스트 + 우유       [자유]   281 kcal
  점심: 닭볶음탕           [한식]   245 kcal
  저녁: 콩나물국           [한식]    28 kcal
       ─── 일 합계:   554 kcal

📅 화 (2026-02-10) ◀ 오늘
  아침: 누룽지            [한식]   149 kcal
  점심: 김치찌개           [한식]   210 kcal
  저녁: 잡채             [한식]   202 kcal
       ─── 일 합계:   562 kcal

📅 수 (2026-02-11)
  아침: 시금치 된장국 + 밥    [한식]   366 kcal
  점심: 두부 조림          [한식]   130 kcal
  저녁: 소고기 무국         [한식]   116 kcal
       ─── 일 합계:   614 kcal

📅 목 (2026-02-12)
  아침: 달걀죽            [한식]   207 kcal
  점심: 제육볶음           [한식]   221 kcal
  저녁: 고등어 구이         [한식]   274 kcal
       ─── 일 합계:   703 kcal

📅 금 (2026-02-13)
  아침: 콩나물국밥          [한식]   259 kcal
  점심: 감자조림           [한식]   137 kcal
  저녁: 애호박 된장찌개       [한식]    70 kcal
       ─── 일 합계:   466 kcal

📅 토 (2026-02-14)
  아침: 계란후라이 + 밥      [한식]   518 kcal
  점심: 새우볶음밥          [자유]   472 kcal
  저녁: 김치볶음밥          [자유]   457 kcal
       ─── 일 합계:  1,448 kcal

📅 일 (2026-02-15)
  아침: 누룽지            [한식]   149 kcal
  점심: 소고기 미역국        [한식]    98 kcal
  저녁: 된장찌개           [한식]   116 kcal
       ─── 일 합계:   363 kcal
```

---

## 📊 알고리즘 검증 결과

| 항목 | 결과 | 상태 |
|------|------|------|
| 전체 메뉴 수 | 21개 (7일 × 3끼) | ✅ |
| 영양 계산 가능 | **21/21 (100%)** | ✅ |
| 평일 한식 비율 | **14/15 (93%)** (기준 80%+) | ✅ |
| 주말 자유 메뉴 | 새우볶음밥, 김치볶음밥 | ✅ |
| 7일 내 중복 없음 | 확인 (누룽지 2회 = 월/일 간격) | ✅ |
| 연속 동일 태그 방지 | 찌개→볶음→국 다양 분산 | ✅ |
| 로테이션 키 | B주 | ✅ |
| 메뉴 재생성 | 기존 삭제 후 재생성 정상 | ✅ |
| 한 끼 교체 | 제육볶음→된장찌개 교체 정상 | ✅ |

---

## 🛒 장보기 리스트 (자동 합산)

| 카테고리 | 재료 |
|---------|------|
| 곡류 (3) | 쌀 1,330g, 빵 60g, 떡 300g |
| 달걀 (1) | 달걀 11개 |
| 양념 (7) | 식용유 15ml, 고추장 45g, 된장 45g, 마늘 5g, 간장 120ml, 소금 4g, 설탕 30g |
| 유제품 (1) | 우유 200ml |
| 육류 (3) | 소고기 400g, 닭고기 300g, 돼지고기 150g |
| 채소 (10) | 시금치 100g, 콩나물 300g, 당근 130g, 애호박 100g, 두부 650g, 감자 530g, 대파 175g, 양파 200g, 배추김치 350g, 무 200g |
| 해산물 (1) | 고등어 300g |
| **합계** | **26개 품목** |

---

## 🔧 발견 이슈 및 개선 사항

### 수정 완료
1. ✅ **cascade 오류**: MenuPlan 삭제 시 ShoppingList가 cascade되지 않는 문제 → `cascade="all, delete-orphan"` 추가
2. ✅ **영양 매핑 부족**: 양념류 18개 재료의 영양DB 매핑 추가 → 100% 계산 가능

### 향후 개선 필요
1. ⚠️ **칼로리 편차**: 국/찌개류 단독 칼로리가 낮음 (밥 별도 계산 필요)
   - 해결: 반찬 레시피에 "밥 200g" 자동 추가 옵션
2. ⚠️ **1인분 기준**: 2인분 레시피에서 1인분 계산 시 실제 섭취량과 차이
   - 해결: `servings_for_user` 값을 사용자 설정에 따라 조정
3. 💡 **밥 포함 여부**: 국/찌개/반찬 레시피에 밥 칼로리(~300kcal) 자동 합산 로직 추가 권장
